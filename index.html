<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三美女遊香港-行程 Web App (即時連網版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

    <style>
        :root {
            --color-blue: #4169E1; /* 萊茵藍 */
            --color-red: #D93025;  /* 港風紅 */
            --color-bg: #F5F7F8;
        }
        .bg-royal-blue { background-color: var(--color-blue); }
        .text-royal-blue { color: var(--color-blue); }
        .bg-deep-red { background-color: var(--color-red); }
        .text-deep-red { color: var(--color-red); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        
        /* 機票卡片虛線效果 */
        .ticket-card { position: relative; background: white; border-radius: 12px; }
        .ticket-card::after {
            content: ""; position: absolute; bottom: 45px; left: 0; right: 0;
            height: 1px; background-image: linear-gradient(to right, #ccc 50%, transparent 50%);
            background-size: 15px 1px; background-repeat: repeat-x;
        }
        .ticket-cutout {
            position: absolute; bottom: 35px; width: 20px; height: 20px;
            background-color: var(--color-bg); border-radius: 50%; z-index: 10;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app" class="max-w-md mx-auto shadow-2xl bg-[#F5F7F8] min-h-screen pb-20">
        
        <header class="bg-royal-blue text-white p-4 sticky top-0 z-40 shadow-lg">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="bg-white/10 p-2 rounded-full w-12 h-12 flex items-center justify-center">
                        <i :class="currentWeather.icon" class="text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold tracking-wider">三美女遊香港</h1>
                        <p class="text-xs opacity-80">
                            香港：{{ currentWeather.description }} {{ currentWeather.temp }}°C 
                            <span class="ml-2">| 匯率 1 : {{ exchangeRate }}</span>
                        </p>
                    </div>
                </div>
                <button @click="toggleEditMode" class="bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full text-sm transition">
                    <i :class="isEditMode ? 'fas fa-check' : 'fas fa-edit'"></i>
                    {{ isEditMode ? '完成' : '編輯' }}
                </button>
            </div>
        </header>

        <nav class="flex overflow-x-auto bg-white border-b sticky top-[72px] z-30 hide-scrollbar">
            <button v-for="menu in menus" :key="menu.tab" 
                @click="activeTab = menu.tab"
                :class="activeTab === menu.tab ? 'text-royal-blue border-b-2 border-royal-blue font-bold' : 'text-gray-500'"
                class="flex-shrink-0 px-6 py-3 text-sm transition-all">
                <i :class="menu.icon" class="mr-1"></i> {{ menu.name }}
            </button>
        </nav>

        <main class="p-4">
            <section v-if="activeTab === 'itinerary'">
                <div class="flex space-x-3 overflow-x-auto pb-4 hide-scrollbar">
                    <div v-for="day in itineraryData" :key="day.date"
                        @click="activeDate = day.date"
                        :class="activeDate === day.date ? 'bg-royal-blue text-white shadow-lg' : 'bg-white text-gray-600'"
                        class="flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center cursor-pointer transition">
                        <span class="text-xs">{{ day.dayOfWeek }}</span>
                        <span class="text-2xl font-bold">{{ day.date.split('/')[2] }}</span>
                    </div>
                </div>

                <div v-for="day in itineraryData" :key="'list-'+day.date">
                    <div v-if="activeDate === day.date" class="space-y-4">
                        <div v-for="(item, idx) in day.items" :key="item.id" 
                            class="bg-white p-4 rounded-xl shadow-sm border-l-4"
                            :style="{'border-left-color': item.category === '航班' ? '#9CA3AF' : '#D93025'}">
                            
                            <div v-if="item.category === '航班'" class="ticket-card p-2">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-xs font-bold text-gray-400">FLIGHT {{ item.flightNumber }}</span>
                                    <i class="fas fa-plane text-royal-blue"></i>
                                </div>
                                <div class="flex justify-between text-center">
                                    <div><p class="text-xl font-bold">{{ item.startTime }}</p><p class="text-xs text-gray-400">HKG</p></div>
                                    <div class="flex-grow flex items-center justify-center px-4">
                                        <div class="border-t border-dashed w-full relative">
                                            <i class="fas fa-plane absolute -top-2 left-1/2 -translate-x-1/2 text-gray-300"></i>
                                        </div>
                                    </div>
                                    <div><p class="text-xl font-bold">{{ item.endTime }}</p><p class="text-xs text-gray-400">TPE</p></div>
                                </div>
                                <div class="ticket-cutout -left-7"></div>
                                <div class="ticket-cutout -right-7"></div>
                            </div>

                            <div v-else>
                                <div class="flex justify-between items-start">
                                    <div>
                                        <span class="text-[10px] px-2 py-0.5 rounded-full bg-red-100 text-red-600 font-bold uppercase">{{ item.category }}</span>
                                        <h3 class="text-lg font-bold mt-1 text-gray-800">{{ item.name }}</h3>
                                    </div>
                                    <button v-if="item.location" @click="openMap(item.location)" class="text-royal-blue p-2">
                                        <i class="fas fa-location-dot"></i>
                                    </button>
                                </div>
                                <div class="mt-2 text-sm text-gray-500 flex items-center">
                                    <i class="far fa-clock mr-2"></i> {{ item.startTime }} - {{ item.endTime }}
                                </div>
                            </div>
                        </div>
                        <button v-if="isEditMode" @click="addItem('itinerary')" class="w-full py-3 border-2 border-dashed border-gray-300 rounded-xl text-gray-400">
                            <i class="fas fa-plus"></i> 新增行程
                        </button>
                    </div>
                </div>
            </section>

            <section v-else-if="activeTab === 'info'" class="space-y-4">
                <div class="bg-white p-5 rounded-2xl shadow-sm">
                    <h3 class="font-bold mb-4 flex items-center text-royal-blue">
                        <i class="fas fa-calculator mr-2"></i> 即時匯率換算
                    </h3>
                    <div class="flex items-center space-x-3">
                        <div class="flex-grow">
                            <label class="text-xs text-gray-400">港幣 HKD</label>
                            <input type="number" v-model="calcHKD" class="w-full text-xl font-bold border-b py-1 outline-none">
                        </div>
                        <i class="fas fa-exchange-alt text-gray-300 mt-4"></i>
                        <div class="flex-grow">
                            <label class="text-xs text-gray-400">台幣 TWD</label>
                            <div class="text-xl font-bold text-deep-red py-1 border-b">{{ (calcHKD * exchangeRate).toFixed(0) }}</div>
                        </div>
                    </div>
                </div>
            </section>

            <section v-else-if="activeTab === 'expense'" class="space-y-4">
                <div class="bg-royal-blue text-white p-6 rounded-3xl shadow-xl">
                    <p class="text-xs opacity-70">目前累計總花費 (TWD)</p>
                    <p class="text-4xl font-black mt-1">NT$ {{ totalExpenseTWD.toLocaleString() }}</p>
                </div>
                <div v-for="exp in expenses" :key="exp.id" class="bg-white p-4 rounded-xl flex justify-between items-center">
                    <div>
                        <p class="font-bold">{{ exp.name }}</p>
                        <p class="text-xs text-gray-400">{{ exp.date }} · {{ exp.category }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-deep-red font-bold">{{ exp.amount }} {{ exp.currency }}</p>
                        <p class="text-[10px] text-gray-400">≈ {{ (exp.amount * (exp.currency === 'HKD' ? exchangeRate : 1)).toFixed(0) }} TWD</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                // 狀態定義
                const isEditMode = ref(false);
                const activeTab = ref('itinerary');
                const activeDate = ref('2026/03/06');
                const calcHKD = ref(100);
                const exchangeRate = ref(4.15); // 預設匯率
                const currentWeather = ref({ temp: '--', description: '讀取中', icon: 'fas fa-spinner fa-spin' });

                // 選單配置 [cite: 10]
                const menus = [
                    { tab: 'itinerary', name: '每日行程', icon: 'fas fa-calendar-alt' },
                    { tab: 'info', name: '旅行資訊', icon: 'fas fa-info-circle' },
                    { tab: 'shopping', name: '購物清單', icon: 'fas fa-shopping-bag' },
                    { tab: 'expense', name: '花費記錄', icon: 'fas fa-hand-holding-usd' }
                ];

                // 範例行程數據 [cite: 12]
                const itineraryData = ref([
                    {
                        date: '2026/03/06', dayOfWeek: 'Fri',
                        items: [
                            { id: 1, category: '航班', name: '國泰航空 CX495', flightNumber: 'CX495', startTime: '13:20', endTime: '15:20' },
                            { id: 2, category: '住宿', name: '香港尖沙咀凱悅酒店', startTime: '16:30', endTime: '17:00', location: 'Hyatt Regency Hong Kong Tsim Sha Tsui' }
                        ]
                    }
                ]);

                const expenses = ref([
                    { id: 1, name: '機場快線', category: '交通', amount: 110, currency: 'HKD', date: '03/06' }
                ]);

                // 即時數據抓取邏輯 
                const fetchLiveUpdate = async () => {
                    // 1. 抓取匯率 (HKD -> TWD)
                    try {
                        const res = await fetch('https://api.frankfurter.dev/v1/latest?base=HKD&symbols=TWD');
                        const data = await res.json();
                        exchangeRate.value = data.rates.TWD.toFixed(2);
                    } catch (e) { console.warn("匯率更新失敗"); }

                    // 2. 抓取香港天氣 (Open-Meteo)
                    try {
                        const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=22.2783&longitude=114.1747&current_weather=true');
                        const data = await res.json();
                        const code = data.current_weather.weathercode;
                        const weatherMap = { 0: '晴朗', 1: '晴間多雲', 3: '陰天', 61: '小雨' };
                        currentWeather.value = {
                            temp: Math.round(data.current_weather.temperature),
                            description: weatherMap[code] || '多雲',
                            icon: code === 0 ? 'fas fa-sun text-yellow-400' : 'fas fa-cloud text-gray-300'
                        };
                    } catch (e) { console.warn("天氣更新失敗"); }
                };

                // 計算屬性
                const totalExpenseTWD = computed(() => {
                    return expenses.value.reduce((sum, item) => {
                        const rate = item.currency === 'HKD' ? exchangeRate.value : 1;
                        return sum + (item.amount * rate);
                    }, 0);
                });

                // 功能方法
                const toggleEditMode = () => isEditMode.value = !isEditMode.value;
                const openMap = (loc) => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc)}`, '_blank');

                onMounted(() => {
                    fetchLiveUpdate();
                    // 這裡可加入 Firebase 初始化邏輯
                });

                return {
                    isEditMode, activeTab, activeDate, menus, itineraryData, expenses,
                    calcHKD, exchangeRate, currentWeather, totalExpenseTWD,
                    toggleEditMode, openMap
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
